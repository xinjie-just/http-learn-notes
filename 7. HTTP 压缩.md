# HTTP 协议中的数据压缩

数据压缩是提高 Web 站点性能的一种重要手段。可以大大减低对于带宽的需求。

数据压缩会在三个不同的层面发挥作用：

- 首先某些格式的文件会采用特定的优化算法进行压缩，
- 其次在 HTTP 协议层面会进行通用数据加密，即数据资源会以压缩的形式进行端到端传输，
- 最后数据压缩还会发生在网络连接层面，即发生在 HTTP 连接的两个节点之间。

## 1. 文件格式压缩

用于文件的压缩算法可以大致分为两类：

- 无损压缩。在压缩与解压缩的循环期间，不会对要恢复的数据进行修改。复原后的数据与原始数据是一致的（比特与比特之间一一对应）。对于图片文件来说，`gif` 或者 `png` 格式的文件就是采用了无损压缩算法。
- 有损压缩。在压缩与解压缩的循环期间，会对原始数据进行修改，但是会（希望）以用户无法觉察的方式进行。``网络上的视频文件通常采用有损压缩算法，`jpeg` 格式的图片也是有损压缩。``

有损压缩通常会比无损压缩效率更高一些。

## 2. 端到端的数据压缩

为了选择要采用的压缩算法，浏览器和服务器之间会使用主动协商机制。浏览器发送 `Accept-Encoding` 标头，其中包含有它所支持的压缩算法，以及各自的优先级，服务器则从中选择一种，使用该算法对响应的消息主体进行压缩，并且发送 `Content-Encoding` 标头来告知浏览器它选择了哪一种算法。

![HTTP 压缩](./images/httpcompression1.png)
